services:
  # Servicio Web Principal (Frappe + Workers)
  - type: web
    name: gestion-medica
    runtime: docker
    plan: starter # O el plan que prefieras
    healthCheckPath: /
    envVars:
      - key: SITE_NAME
        value: gestion.tu-dominio.com
      - key: ADMIN_PASSWORD
        sync: false
      - key: DB_ROOT_PASSWORD
        sync: false
      # Configuraci√≥n S3 (AWS)
      - key: S3_ENABLE
        value: "1"
      - key: S3_KEY
        sync: false
      - key: S3_SECRET
        sync: false
      - key: S3_BUCKET
        value: tu-bucket-frappe
      - key: S3_REGION
        value: us-east-1
      - key: S3_ENDPOINT # Opcional si usas algo distinto a AWS standard
        value: https://s3.amazonaws.com
      
      # Conexiones Internas
      - key: DB_HOST
        fromService:
          type: pserv
          name: mariadb
          property: host
      - key: DB_PORT
        fromService:
          type: pserv
          name: mariadb
          property: port
      - key: REDIS_CACHE
        fromService:
          type: keyvalue
          name: redis-cache
          property: connectionString
      - key: REDIS_QUEUE
        fromService:
          type: keyvalue
          name: redis-queue
          property: connectionString
    
    # IMPORTANTE: Render requiere un disco para los assets locales y logs si no quieres perderlos
    disk:
      name: frappe-sites
      mountPath: /home/frappe/frappe-bench/sites
      sizeGB: 10

  # Base de Datos MariaDB
  - type: pserv
    name: mariadb
    runtime: image
    image:
      url: mariadb:10.11
    envVars:
      - key: MARIADB_ROOT_PASSWORD
        sync: false
      - key: MARIADB_DATABASE
        value: frappe
      - key: MARIADB_CHARACTER_SET_SERVER
        value: utf8mb4
      - key: MARIADB_COLLATION_SERVER
        value: utf8mb4_unicode_ci
    disk:
      name: mariadb-data
      mountPath: /var/lib/mysql
      sizeGB: 20

  # Redis para Cache y Queues
  - type: keyvalue
    name: redis-cache
    plan: starter
  - type: keyvalue
    name: redis-queue
    plan: starter